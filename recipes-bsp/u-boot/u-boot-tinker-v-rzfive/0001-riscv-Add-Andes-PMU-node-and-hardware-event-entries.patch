From 40d9296145d66fb3a5f50a1798780277dc4fc3bc Mon Sep 17 00:00:00 2001
From: Yu Chien Peter Lin <peterlin@andestech.com>
Date: Sat, 26 Aug 2023 20:37:17 +0800
Subject: [PATCH] riscv: Add Andes PMU node and hardware event entries

Upstream-Status: Pending
---
 arch/riscv/dts/r9a07g043f.dtsi | 67 ++++++++++++++++++++++++++++++++++
 1 file changed, 67 insertions(+)

diff --git a/arch/riscv/dts/r9a07g043f.dtsi b/arch/riscv/dts/r9a07g043f.dtsi
index eabffa8ad1..ad2f9714a1 100644
--- a/arch/riscv/dts/r9a07g043f.dtsi
+++ b/arch/riscv/dts/r9a07g043f.dtsi
@@ -63,6 +63,73 @@
 		andes,data-ram-ctl = <1 0>;
 	};
 
+	pmu: pmu {
+		compatible = "riscv,pmu";
+		device_type = "pmu";
+		riscv,event-to-mhpmevent = <0x3 0x0000 0x41>, /* D-Cache access */
+					   <0x4 0x0000 0x51>, /* D-Cache miss */
+					   <0x10000 0x0000 0x61>, /* D-Cache load access */
+					   <0x10001 0x0000 0x71>, /* D-Cache load miss */
+					   <0x10002 0x0000 0x81>, /* D-Cache store access */
+					   <0x10003 0x0000 0x91>, /* D-Cache store miss */
+					   <0x10008 0x0000 0x21>, /* I-Cache access */
+					   <0x10009 0x0000 0x31>; /* I-Cache miss */
+		riscv,event-to-mhpmcounters = <0x3 0x4 0x78>,
+					      <0x10000 0x10003 0x78>,
+					      <0x10008 0x10009 0x78>;
+		riscv,raw-event-to-mhpmcounters = <0x0 0x30 0xffffffff 0xffffffff 0x78>, /* Integer load instruction count */
+						  <0x0 0x40 0xffffffff 0xffffffff 0x78>, /* Integer store instruction count */
+						  <0x0 0x50 0xffffffff 0xffffffff 0x78>, /* Atomic instruction count */
+						  <0x0 0x60 0xffffffff 0xffffffff 0x78>, /* System instruction count */
+						  <0x0 0x70 0xffffffff 0xffffffff 0x78>, /* Integer computational instruction count */
+						  <0x0 0x80 0xffffffff 0xffffffff 0x78>, /* Conditional branch instruction count */
+						  <0x0 0x90 0xffffffff 0xffffffff 0x78>, /* Taken conditional branch instruction count */
+						  <0x0 0xA0 0xffffffff 0xffffffff 0x78>, /* JAL instruction count */
+						  <0x0 0xB0 0xffffffff 0xffffffff 0x78>, /* JALR instruction count */
+						  <0x0 0xC0 0xffffffff 0xffffffff 0x78>, /* Return instruction count */
+						  <0x0 0xD0 0xffffffff 0xffffffff 0x78>, /* Control transfer instruction count */
+						  <0x0 0xE0 0xffffffff 0xffffffff 0x78>, /* EXEC.IT instruction count */
+						  <0x0 0xF0 0xffffffff 0xffffffff 0x78>, /* Integer multiplication instruction count */
+						  <0x0 0x100 0xffffffff 0xffffffff 0x78>, /* Integer division instruction count */
+						  <0x0 0x110 0xffffffff 0xffffffff 0x78>, /* Floating-point load instruction count */
+						  <0x0 0x120 0xffffffff 0xffffffff 0x78>, /* Floating-point store instruction count */
+						  <0x0 0x130 0xffffffff 0xffffffff 0x78>, /* Floating-point addition instruction count */
+						  <0x0 0x140 0xffffffff 0xffffffff 0x78>, /* Floating-point multiplication instruction count */
+						  <0x0 0x150 0xffffffff 0xffffffff 0x78>, /* Floating-point fused multiply-add instruction count */
+						  <0x0 0x160 0xffffffff 0xffffffff 0x78>, /* Floating-point division or square-root instruction count */
+						  <0x0 0x170 0xffffffff 0xffffffff 0x78>, /* Other floating-point instruction count */
+						  <0x0 0x180 0xffffffff 0xffffffff 0x78>, /* Integer multiplication and add/sub instruction count */
+						  <0x0 0x190 0xffffffff 0xffffffff 0x78>, /* Retired operation count */
+						  <0x0 0x01 0xffffffff 0xffffffff 0x78>, /* ILM access */
+						  <0x0 0x11 0xffffffff 0xffffffff 0x78>, /* DLM access */
+						  <0x0 0x21 0xffffffff 0xffffffff 0x78>, /* I-Cache access */
+						  <0x0 0x31 0xffffffff 0xffffffff 0x78>, /* I-Cache miss */
+						  <0x0 0x41 0xffffffff 0xffffffff 0x78>, /* D-Cache access */
+						  <0x0 0x51 0xffffffff 0xffffffff 0x78>, /* D-Cache miss */
+						  <0x0 0x61 0xffffffff 0xffffffff 0x78>, /* D-Cache load access */
+						  <0x0 0x71 0xffffffff 0xffffffff 0x78>, /* D-Cache load miss */
+						  <0x0 0x81 0xffffffff 0xffffffff 0x78>, /* D-Cache store access */
+						  <0x0 0x91 0xffffffff 0xffffffff 0x78>, /* D-Cache store miss */
+						  <0x0 0xA1 0xffffffff 0xffffffff 0x78>, /* D-Cache writeback */
+						  <0x0 0xB1 0xffffffff 0xffffffff 0x78>, /* Cycles waiting for I-Cache fill data */
+						  <0x0 0xC1 0xffffffff 0xffffffff 0x78>, /* Cycles waiting for D-Cache fill data */
+						  <0x0 0xD1 0xffffffff 0xffffffff 0x78>, /* Uncached fetch data access from bus */
+						  <0x0 0xE1 0xffffffff 0xffffffff 0x78>, /* Uncached load data access from bus */
+						  <0x0 0xF1 0xffffffff 0xffffffff 0x78>, /* Cycles waiting for uncached fetch data from bus */
+						  <0x0 0x101 0xffffffff 0xffffffff 0x78>, /* Cycles waiting for uncached load data from bus */
+						  <0x0 0x111 0xffffffff 0xffffffff 0x78>, /* Main ITLB access */
+						  <0x0 0x121 0xffffffff 0xffffffff 0x78>, /* Main ITLB miss */
+						  <0x0 0x131 0xffffffff 0xffffffff 0x78>, /* Main DTLB access */
+						  <0x0 0x141 0xffffffff 0xffffffff 0x78>, /* Main DTLB miss */
+						  <0x0 0x151 0xffffffff 0xffffffff 0x78>, /* Cycles waiting for Main ITLB fill data */
+						  <0x0 0x161 0xffffffff 0xffffffff 0x78>, /* Pipeline stall cycles caused by Main DTLB miss */
+						  <0x0 0x171 0xffffffff 0xffffffff 0x78>, /* Hardware prefetch bus access */
+						  <0x0 0x181 0xffffffff 0xffffffff 0x78>, /* Cycles waiting for source operand ready in the integer register file scoreboard */
+						  <0x0 0x02 0xffffffff 0xffffffff 0x78>, /* Misprediction of conditional branches */
+						  <0x0 0x12 0xffffffff 0xffffffff 0x78>, /* Misprediction of taken conditional branches */
+						  <0x0 0x22 0xffffffff 0xffffffff 0x78>; /* Misprediction of targets of Return instructions */
+	};
+
 	/*
 	 * The external audio clocks are configured as 0 Hz fixed frequency
 	 * clocks by default.
-- 
2.34.1

