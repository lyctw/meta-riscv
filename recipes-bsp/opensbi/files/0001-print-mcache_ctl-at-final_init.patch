From 3c6010dfd99ba4a73b611ee2c9bd581b9ee1190e Mon Sep 17 00:00:00 2001
From: Kas User <kas@example.com>
Date: Sat, 17 Jun 2023 05:01:04 +0000
Subject: [PATCH] print mcache_ctl at final_init

---
 platform/generic/andes/andes_sbi.c       | 2 ++
 platform/generic/renesas/rzfive/rzfive.c | 5 ++++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/platform/generic/andes/andes_sbi.c b/platform/generic/andes/andes_sbi.c
index 3e89fb9..19a7ef8 100644
--- a/platform/generic/andes/andes_sbi.c
+++ b/platform/generic/andes/andes_sbi.c
@@ -7,6 +7,7 @@
 #include <andes/andes_sbi.h>
 #include <sbi/riscv_asm.h>
 #include <sbi/sbi_error.h>
+#include <sbi/sbi_console.h>
 
 enum sbi_ext_andes_fid {
 	SBI_EXT_ANDES_FID0 = 0, /* Reserved for future use */
@@ -29,6 +30,7 @@ static bool andes45_iocp_disabled(void)
 
 static bool andes45_apply_iocp_sw_workaround(void)
 {
+	sbi_printf("andes45_cache_controllable(): %x\n", andes45_cache_controllable());
 	return andes45_cache_controllable() & andes45_iocp_disabled();
 }
 
diff --git a/platform/generic/renesas/rzfive/rzfive.c b/platform/generic/renesas/rzfive/rzfive.c
index 8c49ac9..06aeaa7 100644
--- a/platform/generic/renesas/rzfive/rzfive.c
+++ b/platform/generic/renesas/rzfive/rzfive.c
@@ -10,6 +10,7 @@
 #include <sbi/riscv_asm.h>
 #include <platform_override.h>
 #include <sbi/sbi_domain.h>
+#include <sbi/sbi_console.h>
 #include <sbi_utils/fdt/fdt_helper.h>
 
 static const struct andes45_pma_region renesas_rzfive_pma_regions[] = {
@@ -27,13 +28,15 @@ static const struct andes45_pma_region renesas_rzfive_pma_regions[] = {
 
 static int renesas_rzfive_final_init(bool cold_boot, const struct fdt_match *match)
 {
+	sbi_printf("@@@@@@@@@@@@@@@ $mcache_ctl: %#lx\n", csr_read(CSR_MCACHE_CTL));
+	csr_write(CSR_MCACHE_CTL, 0x183f03ul);
+	sbi_printf("@@@@@@@@@@@@@@@ $mcache_ctl: %#lx\n", csr_read(CSR_MCACHE_CTL));
 	return andes45_pma_setup_regions(renesas_rzfive_pma_regions,
 					 array_size(renesas_rzfive_pma_regions));
 }
 
 int renesas_rzfive_early_init(bool cold_boot, const struct fdt_match *match)
 {
-	csr_write(CSR_MCACHE_CTL, 0x183f03ul);
 	/*
 	 * Renesas RZ/Five RISC-V SoC has Instruction local memory and
 	 * Data local memory (ILM & DLM) mapped between region 0x30000
