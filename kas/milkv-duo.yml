header:
  version: 14
  includes:
    - base-riscv.yml

machine: milkv-duo 
target:
  - core-image-minimal

local_conf_header:
  nezha: |
    BB_GIT_SHALLOW = "1"
    # Keep only the top commit
    BB_GIT_SHALLOW_DEPTH = "1"
    # This defaults to enabled if both BB_GIT_SHALLOW and
    # BB_GENERATE_MIRROR_TARBALLS are enabled
    BB_GENERATE_SHALLOW_TARBALLS = "1"
    PREFERRED_VERSION_linux-libc-headers = "6.1%"
    TCLIBC = "musl"
    INIT_MANAGER = "systemd"

    # Use 'haveged' instead 'rng-tools' due to 'SIGSEGV' error during start 'rngd'
    PACKAGE_EXCLUDE:append = "rng-tools"

    IMAGE_INSTALL:append = "haveged "
    IMAGE_INSTALL:append = " kernel-devsrc kernel-modules kernel-dev"
    #IMAGE_INSTALL:append = " lkrg-module"
    IMAGE_INSTALL:append = " btop htop strace vim git e2fsprogs-resize2fs util-linux"
    IMAGE_INSTALL:append = " packagegroup-core-buildessential musl-staticdev libstdc++ libstdc++-staticdev"

    IMAGE_FEATURES += " \
        ssh-server-dropbear \
        debug-tweaks \
    "
    EXTRA_IMAGE_FEATURES = "debug-tweaks package-management"
